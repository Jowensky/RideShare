<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" type="text/css" href="./stylesheets/members.css"> 
    <link href="https://fonts.googleapis.com/css?family=Major+Mono+Display|Open+Sans+Condensed:300" rel="stylesheet"> 
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <title>RideShare</title>
  </head>

  <body>

    <h1 id="logo">Ride Share</h1>

    <div class="profileContainer">
      <input id="from" type="text" placeholder="From" /> <input id="to" type="text" placeholder="To"/> <br>
    </div>
    <p style="color:white;font-size:28px;" id="notfound"></p>
    <div id="buttons">
    <button id="search">Search</button><br><button id="previousSearch">Previous</button><br><button id="save">Save</button>
    </div>

    <div class="addressBook">
      <h1>History</h1>
      <ul id="address">
        <p></p>
      </ul>
    </div>

    <section class="compareContent"> 

      <div class="split left">
        <div class="centered">
          <img id="lyftImage" src="./stylesheets/images/p_lyftLogo.png" height="200px;" width="200px;">
          <div style="display:none;" id="lyftContent">
            <p style="color:white;" id="lyftprice"></p>
          </div>
        </div>
      </div>
      
      <div class="split right">
        <div class="centered">
          <img id="uberImage" src="./stylesheets/images/p_uberlogo.png" height="200px;" width="200px;">
          <div style="display:none" id="uberContent">
            <p style="color:white;" id="uberprice"></p>
          </div>   
      </div>
      
    </section>

    <script>

    $(".right").on("click", function() {
      $("#uberImage").toggle();
      $("#uberContent").toggle();
    })
    
    $(".left").on("click", function() {
      $("#lyftImage").toggle();
      $("#lyftContent").toggle();
    })

    // API Calls //
    $("#search").on("click", function(e) {
      e.preventDefault();

      var from = $("#from").val();
      var to = $("#to").val();

      if (from === '' || to === '') {$("#notfound").text('Inputs must be filled'); return false;} else {

      $("#uberPrice").empty();
      $("#lyftPrice").empty();
      $("#notfound").empty();

      var route = {
        from: $("#from")
          .val()
          .trim(),
        to: $("#to")
          .val()
          .trim()
      };
      $.post("/api/price", route, function(data) {
        console.log(data)
        if (data === 'not found') {
          $('#notfound').text(' location or destination not found ');
        } else if (data === 'Distance between two points exceeds 100 miles') {
          $('#notfound').text(data)
        } else {
        $("#uberprice").text(`Uber: ${data[2]}`);
        $("#lyftprice").text(`Lyft: ${data[1]}`);
        }
      });
    }
    });

    $("#previousSearch").on("click", function(e) {
      e.preventDefault();

      $("#address").empty()

      $.post("/address", function(data) {
        for (var add in data.address) {
          var li = $("<li>")
          var br = $("<br>")
          li.attr("data-id",  data.address[add].ID).attr("id", "oldesti").append(`From: ${data.address[add].Location} <br>  To: ${data.address[add].Destination}`).css("border-bottom", "1.5px solid white");
          $("#address").append(li).append(br)
        }
      });
    });

    $("#save").on("click", function(e) {
      e.preventDefault();

      var route = {
        location: $("#from")
          .val()
          .trim(),
          destination: $("#to")
          .val()
          .trim()
      };

      $.post("/api/useraddress", route, function(data) {
        
        console.log('In sql')
      });
    });

    $("body").on("dblclick", "#oldesti", function() {
      console.log('clicked')
      
      $(this).hide();
      var id = $(this).data("id");

      $.ajax("/api/useraddress/" + id, {
        type: "DELETE"
      }).then(
        function() {
          console.log("deleted address" + id);
        }
      );
    })
    // API Calls //

  </script>
</body>
</html>
